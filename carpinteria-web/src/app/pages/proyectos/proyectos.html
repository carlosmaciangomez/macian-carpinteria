<div class="proyectos-page">
    <!-- CABECERA -->
    <header class="header">
        <h1>Proyectos</h1>
        <p>
            Algunos de los trabajos que hemos realizado: cocinas, mobiliario, armarios,
            puertas y proyectos contract para viviendas y negocios.
        </p>
    </header>

    <!-- FILTROS POR CATEGORÍA -->
    <div class="filtros-wrapper">
        @if (categorias$ | async; as categorias) {
        <div class="filtros">
            @for (cat of categorias; track cat.id) {
            <button type="button" (click)="setTipo(cat.id)" [class.filtro-activo]="
              tipoActivo === cat.id ||
              (!tipoActivo && cat.id === 'Todos')
            ">
                {{ cat.name }}
            </button>
            }
        </div>
        }
    </div>

    <!-- GRID DE PROYECTOS -->
    <section class="grid">
        @if (proyectosFiltrados.length > 0) {
        @for (p of proyectosFiltrados; track p.id) {
        <a class="card" [routerLink]="['/proyectos', p.slug]">
            @if (!portadaEsVideo(p)) {
            <img class="portada" [src]="getPortada(p) || 'assets/placeholder-proyecto.jpg'"
                [alt]="p.title || 'Proyecto de carpintería'" />
            } @else {
            <video class="portada" [src]="getPortada(p)" muted></video>
            }

            <div class="card-body">
                <h3>{{ p.title }}</h3>

                <p>
                    {{ p.description }}
                </p>

                <div class="meta">
                    <span class="tipo">
                        {{ (p.category || 'Sin categoría') | titlecase }}
                    </span>
                    <span class="fecha">
                        {{ toDate(p.createdAt) | date:'longDate' }}
                    </span>
                </div>
            </div>
        </a>
        }
        } @else {
        <p class="empty">
            No hay proyectos publicados en esta categoría por el momento.
        </p>
        }
    </section>
</div>