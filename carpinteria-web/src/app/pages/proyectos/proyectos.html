<!-- src/app/pages/proyectos/proyectos.html -->

<div class="proyectos-page">

    <!-- HEADER -->
    <header class="header">
        <h1>Proyectos</h1>
        <p>
            Algunos de los trabajos de carpintería que hemos realizado: cocinas,
            armarios, mobiliario a medida, puertas, revestimientos y proyectos custom.
        </p>
    </header>

    <!-- FILTROS -->
    <section class="filtros-wrapper">
        <div class="filtros">

            <!-- Botón "Todos" -->
            <button type="button" (click)="setTipo('Todos')" [class.filtro-activo]="tipoActivo === 'Todos'">
                Todos
            </button>

            <!-- Botones de categorías desde Firestore -->
            @if (categorias$ | async; as cats) {
            @for (cat of cats; track cat.id) {
            <button type="button" (click)="setTipo(cat.id)" [class.filtro-activo]="tipoActivo === cat.id">
                {{ cat.name }}
            </button>
            }
            }
        </div>
    </section>

    <!-- GRID DE PROYECTOS -->
    <section class="grid">

        @if (proyectosFiltrados.length === 0) {
        <p class="empty">
            No hay proyectos en esta categoría todavía.
        </p>
        } @else {
        @for (p of proyectosFiltrados; track p.id) {

        <article class="card" [routerLink]="['/proyectos', p.slug]">
            <!-- Portada -->
            @if (portadaEsVideo(p)) {
            <video class="portada" [src]="getPortada(p)" muted></video>
            } @else {
            <img class="portada" [src]="getPortada(p)" [alt]="p.title" />
            }

            <!-- Texto -->
            <div class="card-body">
                <h3>{{ p.title }}</h3>

                <p>
                    {{ p.description }}
                </p>

                <div class="meta">
                    <span class="tipo">
                        {{ p.category || 'Proyecto' }}
                    </span>
                    <span class="fecha">
                        {{ toDate(p.createdAt) | date:'longDate' }}
                    </span>
                </div>
            </div>
        </article>

        }
        }

    </section>
</div>